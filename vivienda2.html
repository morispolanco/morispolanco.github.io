<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Prudencial de Vivienda Guatemala üè†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; margin-bottom: 10px; font-size: 2.2em; }
        .subtitle { color: #666; font-style: italic; font-size: 1.1em; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .tab-btn:hover { background: #667eea; color: white; }
        .tab-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none;
        }
        .tab-content.active { display: block; }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background-color: #f9f9ff;
        }
        button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }
        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .result {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-top: 20px;
            border-radius: 6px;
            display: none;
        }
        .result.show { display: block; }
        .result h3 { color: #667eea; margin-bottom: 10px; }
        .result-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 3px solid #764ba2;
        }
        .metric {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px 5px 5px 0;
            font-size: 0.9em;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
        }
        .card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
        }
        .card h4 { color: #667eea; margin-bottom: 10px; }
        .card p { color: #666; font-size: 0.95em; }
        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-bottom: 10px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover { background: #f9f9f9; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-content h3 { color: #667eea; margin-bottom: 15px; }
        .close-btn {
            float: right;
            cursor: pointer;
            font-size: 1.5em;
            color: #999;
            background: none;
            border: none;
            padding: 0;
        }
        .close-btn:hover { color: #333; }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        @media (max-width: 768px) {
            h1 { font-size: 1.6em; }
            .tabs { flex-direction: column; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè† Sistema de Inteligencia Prudencial para Vivienda</h1>
            <p class="subtitle">Aplicando principios de "Ni magia ni m√©todo" de Moris Polanco</p>
            <p style="margin-top: 10px; color: #999;">Basado en ENCOVI 2023 | Datos actualizados 2026</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('simulator')">üéØ Simulador</button>
            <button class="tab-btn" onclick="showTab('departments')">üìç Departamentos</button>
            <button class="tab-btn" onclick="showTab('families')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Tipos de Familia</button>
            <button class="tab-btn" onclick="showTab('solutions')">üí° Soluciones</button>
            <button class="tab-btn" onclick="showTab('matrix')">üìä Matriz Operativa</button>
            <button class="tab-btn" onclick="showTab('about')">‚ÑπÔ∏è Polanco & Graci√°n</button>
            <button class="tab-btn" onclick="showTab('download')">üì• Descargar An√°lisis</button>
        </div>

        <!-- TAB 1: SIMULADOR -->
        <div id="simulator" class="tab-content active">
            <h2>üéØ Simulador de Acceso a Vivienda</h2>
            <p style="margin-bottom: 20px; color: #666;">Ingresa tu informaci√≥n para obtener una soluci√≥n personalizada</p>
            
            <div class="form-group">
                <label for="department">Departamento:</label>
                <select id="department">
                    <option value="">Selecciona...</option>
                    <option value="Alta Verapaz">Alta Verapaz (90.3% pobreza)</option>
                    <option value="Quich√©">Quich√© (86.4% pobreza)</option>
                    <option value="Huehuetenango">Huehuetenango (81.3% pobreza)</option>
                    <option value="Baja Verapaz">Baja Verapaz (80.1% pobreza)</option>
                    <option value="Jalapa">Jalapa (79.9% pobreza)</option>
                    <option value="Guatemala">Guatemala (21.6% pobreza)</option>
                    <option value="Sacatep√©quez">Sacatep√©quez (38.7% pobreza)</option>
                    <option value="Escuintla">Escuintla (39.2% pobreza)</option>
                    <option value="Otro">Otro departamento</option>
                </select>
            </div>

            <div class="form-group">
                <label for="family-type">Tipo de Familia:</label>
                <select id="family-type">
                    <option value="">Selecciona...</option>
                    <option value="extreme-rural">Pobreza Extrema Rural (&lt;Q1,500/mes)</option>
                    <option value="poor-urban">Pobre Urbana Informal (Q2,500-3,500/mes)</option>
                    <option value="working-class">Clase Trabajadora Formal (Q4,500-7,000/mes)</option>
                    <option value="middle-class">Clase Media Emergente (Q7,000-12,000/mes)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="monthly-income">Ingreso Mensual (Q):</label>
                <input type="number" id="monthly-income" placeholder="Ej: 3500" min="500">
            </div>

            <div class="form-group">
                <label for="family-size">Tama√±o de Familia:</label>
                <select id="family-size">
                    <option value="2">2 personas</option>
                    <option value="3">3 personas</option>
                    <option value="4" selected>4 personas</option>
                    <option value="5">5 personas</option>
                    <option value="6">6 personas</option>
                    <option value="7">7+ personas</option>
                </select>
            </div>

            <div class="form-group">
                <label for="location">Ubicaci√≥n preferida:</label>
                <select id="location">
                    <option value="rural">Rural</option>
                    <option value="urban" selected>Urbana</option>
                    <option value="peri-urban">Periurbana</option>
                </select>
            </div>

            <button onclick="calculateSolution()">üìä Calcular Mi Soluci√≥n</button>

            <div id="result" class="result">
                <h3>‚úÖ Tu Soluci√≥n Personalizada</h3>
                <div id="result-content"></div>
            </div>
        </div>

        <!-- TAB 2: DEPARTAMENTOS -->
        <div id="departments" class="tab-content">
            <h2>üìç Departamentos Clasificados por Pobreza</h2>
            <p style="margin-bottom: 20px; color: #666;">Estrategias diferenciadas seg√∫n contexto local</p>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: #764ba2; margin-bottom: 15px;">üî¥ GRUPO A: Extrema Pobreza Rural (>80%)</h3>
                <div class="grid" id="group-a"></div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">üü† GRUPO B: Pobreza Alta Mixta (50-79%)</h3>
                <div class="grid" id="group-b"></div>
            </div>

            <div>
                <h3 style="color: #28a745; margin-bottom: 15px;">üü¢ GRUPO C: Pobreza Moderada (< 50%)</h3>
                <div class="grid" id="group-c"></div>
            </div>
        </div>

        <!-- TAB 3: TIPOS DE FAMILIA -->
        <div id="families" class="tab-content">
            <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Tipos de Familia y Soluciones</h2>
            <p style="margin-bottom: 20px; color: #666;">Cada familia tiene una ruta diferente hacia vivienda propia</p>
            
            <div class="grid" id="family-types"></div>
        </div>

        <!-- TAB 4: SOLUCIONES -->
        <div id="solutions" class="tab-content">
            <h2>üí° Soluciones Operativas</h2>
            <p style="margin-bottom: 20px; color: #666;">Modelos replicables basados en casos exitosos</p>
            
            <div class="grid" id="solutions-grid"></div>
        </div>

        <!-- TAB 5: MATRIZ OPERATIVA -->
        <div id="matrix" class="tab-content">
            <h2>üìä Matriz Operativa: 16 Soluciones Detalladas</h2>
            <p style="margin-bottom: 20px; color: #666;">Desglose completo: QU√â CONSISTE, QU√â HACE GOBIERNO, QU√â HACE FAMILIA</p>
            
            <div class="form-group">
                <label for="family-filter">Filtrar por Tipo de Familia:</label>
                <select id="family-filter" onchange="filterMatrixSolutions()">
                    <option value="">Todas las soluciones (16)</option>
                    <option value="Pobreza Extrema Rural">Pobreza Extrema Rural (4 soluciones)</option>
                    <option value="Pobre Urbana Informal">Pobre Urbana Informal (4 soluciones)</option>
                    <option value="Clase Trabajadora Formal">Clase Trabajadora Formal (4 soluciones)</option>
                    <option value="Clase Media Emergente">Clase Media Emergente (4 soluciones)</option>
                </select>
            </div>

            <div id="matrix-grid" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                <!-- Se llena din√°micamente con JavaScript -->
            </div>
        </div>

        <!-- TAB 6: PRINCIPIOS -->
        <div id="about" class="tab-content">
            <h2>‚ÑπÔ∏è Fundamento Filos√≥fico: "Ni magia ni m√©todo"</h2>
            <p style="margin-bottom: 20px; color: #666;">Sistema basado en el libro de Moris Polanco. Rechaza tanto la "magia" como el "m√©todo mecanicista"</p>
            
            <h3 style="color: #667eea; margin-top: 20px;">1Ô∏è‚É£ LA T√ìPICA (Arist√≥teles)</h3>
            <p><strong>¬øQu√© es?</strong> Arte de encontrar argumentos usando "lugares" (topoi) como dep√≥sitos de ideas.</p>
            <p><strong>Aplicaci√≥n:</strong> Interrogamos cada departamento con 5 preguntas:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Definici√≥n:</strong> ¬øQu√© tipo de vivienda espec√≠fica se necesita?</li>
                <li><strong>G√©nero:</strong> ¬øEs rural, urbana o periurbana?</li>
                <li><strong>Causa:</strong> ¬øQu√© genera la pobreza en este lugar?</li>
                <li><strong>Comparaci√≥n:</strong> ¬øQu√© funciona en departamentos vecinos?</li>
                <li><strong>Tiempo:</strong> ¬øCu√°l es el momento oportuno para actuar?</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 20px;">2Ô∏è‚É£ LA PRUDENCIA (Graci√°n)</h3>
            <p><strong>¬øQu√© es?</strong> Sabidur√≠a pr√°ctica: saber qu√© hacer en cada situaci√≥n concreta, adapt√°ndose al contexto.</p>
            <p><strong>Aplicaci√≥n:</strong> NO aplicamos soluci√≥n √∫nica. Reconocemos que:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Guatemala (21% pobreza, urbano) ‚â† Alta Verapaz (90% pobreza, rural)</li>
                <li>Cada departamento tiene su propia estrategia (cooperativas, lotes, PPP, densificaci√≥n)</li>
                <li>La "variaci√≥n de la conducta" es virtud, no defecto</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 20px;">3Ô∏è‚É£ LA ABDUCCI√ìN (Peirce)</h3>
            <p><strong>¬øQu√© es?</strong> Conjetura inteligente: salto l√≥gico que genera nueva idea a partir de anomal√≠a observada.</p>
            <p><strong>Aplicaci√≥n:</strong> Ciclo Sorpresa ‚Üí Suspicacia ‚Üí Verificaci√≥n</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Sorpresa:</strong> ¬øPor qu√© Alta Verapaz es 90% pobre pero no es prioritario?</li>
                <li><strong>Suspicacia:</strong> Quiz√°s cooperativas + suelo comunal + subsidio = soluci√≥n</li>
                <li><strong>Verificaci√≥n:</strong> ¬øExisten modelos existentes? S√≠: Fe y Esperanza, EMVDU</li>
            </ul>
            
            <h3 style="color: #667eea; margin-top: 20px;">4Ô∏è‚É£ EL KAIROS (Tiempo Oportuno)</h3>
            <p><strong>¬øQu√© es?</strong> Inteligencia de la ocasi√≥n: saber cu√°ndo actuar, no todo se hace simult√°neamente.</p>
            <p><strong>Aplicaci√≥n:</strong> Identificamos tres niveles temporales:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>La ventana actual (2026):</strong> Gobierno enfocado en pobreza, presupuesto FOPAVI aumentado</li>
                <li><strong>Punto de presi√≥n:</strong> Iniciar en Grupo A (>80% pobreza) para m√°ximo impacto</li>
                <li><strong>Saz√≥n de las cosas:</strong> Antes de que consolidaci√≥n informal haga imposible intervenir</li>
            </ul>

            <div style="background: #f0f4ff; border-left: 4px solid #667eea; padding: 15px; border-radius: 6px; margin-top: 20px;">
                <strong>üìö Referencia:</strong> Moris Polanco, <em>Ni magia ni m√©todo: El arte prudencial de descubrir ideas nuevas</em> (2026)
            </div>

            <div class="success" style="margin-top: 20px;">
                <strong>üí≠ Reflexi√≥n de Graci√°n:</strong><br>
                "La tiran√≠a de la circunstancia solo se vence con inteligencia de la ocasi√≥n."
            </div>

            <div style="background: #fff9e6; border-left: 4px solid #f39c12; padding: 15px; border-radius: 6px; margin-top: 20px;">
                <strong>‚ö° S√≠ntesis operativa:</strong><br>
                Este sistema rechaza la "magia" (esperar que FOPAVI solo resuelva) y el "m√©todo mecanicista" (aplicar receta √∫nica a 22 departamentos). Propone la <strong>prudencia graciana</strong>: observaci√≥n atenta + variaci√≥n inteligente + escucha del tiempo oportuno.
            </div>
        </div>
    </div>

        <!-- TAB 7: DESCARGAS -->
    <div id="download" class="tab-content">
        <h2>üì• Documentos Disponibles para Descargar</h2>
        <p style="margin-bottom: 20px; color: #666;">An√°lisis estrat√©gico completo y datos para uso en pol√≠tica p√∫blica</p>
        
        <div class="grid">
            <div class="card" onclick="downloadDocument('estrategia')">
                <h4>üìÑ An√°lisis Estrat√©gico Completo</h4>
                <p>11 secciones con mapeo t√≥pico, soluciones por familia, cronograma graciano (2026-2029)</p>
                <div style="margin-top: 10px;">
                    <span class="metric">üìä 11 secciones</span>
                    <span class="metric">üí∞ Presupuesto detallado</span>
                </div>
                <p style="margin-top: 10px; color: #667eea; font-weight: 600;">Descargar en Markdown ‚Üí</p>
            </div>
            
            <div class="card" onclick="downloadDocument('datos')">
                <h4>üìã Base de Datos 2026</h4>
                <p>Datos actualizados: 22 departamentos, salarios m√≠nimos 2026, costos construcci√≥n, FOPAVI</p>
                <div style="margin-top: 10px;">
                    <span class="metric">22 departamentos</span>
                    <span class="metric">Formato JSON</span>
                </div>
                <p style="margin-top: 10px; color: #667eea; font-weight: 600;">Descargar en JSON ‚Üí</p>
            </div>
            
            <div class="card" onclick="downloadDocument('matrices')">
                <h4>üóÇÔ∏è Matrices Operativas</h4>
                <p>Tablas de decisi√≥n: por departamento, por tipo de familia, por presupuesto, indicadores de monitoreo</p>
                <div style="margin-top: 10px;">
                    <span class="metric">5 matrices</span>
                    <span class="metric">Excel-ready</span>
                </div>
                <p style="margin-top: 10px; color: #667eea; font-weight: 600;">Descargar en CSV ‚Üí</p>
            </div>
        </div>

        <div class="warning" style="margin-top: 30px;">
            <strong>‚ÑπÔ∏è Nota:</strong> Los documentos est√°n dise√±ados para uso en di√°logos de pol√≠tica p√∫blica, capacitaci√≥n de funcionarios, argumentaci√≥n legislativa y replicaci√≥n en otros pa√≠ses de Centroam√©rica.
        </div>
    </div>

    <!-- MODAL DETALLE -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        const departmentsData = {
            "Alta Verapaz": { poverty: 90.3, extreme: 58.5, population: 1200000, urban: 10, group: "A" },
            "Quich√©": { poverty: 86.4, extreme: 34.4, population: 1100000, urban: 15, group: "A" },
            "Huehuetenango": { poverty: 81.3, extreme: 29.7, population: 1200000, urban: 20, group: "A" },
            "Baja Verapaz": { poverty: 80.1, extreme: 35.8, population: 330000, urban: 20, group: "A" },
            "Jalapa": { poverty: 79.9, extreme: 34.5, population: 350000, urban: 25, group: "A" },
            "Santa Rosa": { poverty: 74.0, extreme: 16.2, population: 400000, urban: 35, group: "B" },
            "Jutiapa": { poverty: 74.0, extreme: 18.8, population: 550000, urban: 30, group: "B" },
            "Totonicap√°n": { poverty: 62.1, extreme: 10.1, population: 500000, urban: 35, group: "B" },
            "Solol√°": { poverty: 61.9, extreme: 8.8, population: 450000, urban: 40, group: "B" },
            "Chiquimula": { poverty: 59.6, extreme: 25.3, population: 400000, urban: 35, group: "B" },
            "San Marcos": { poverty: 53.7, extreme: 6.9, population: 1000000, urban: 45, group: "B" },
            "Suchitep√©quez": { poverty: 53.7, extreme: 7.7, population: 550000, urban: 50, group: "B" },
            "Zacapa": { poverty: 52.6, extreme: 13.5, population: 230000, urban: 45, group: "B" },
            "Retalhuleu": { poverty: 50.9, extreme: 4.1, population: 320000, urban: 55, group: "B" },
            "Pet√©n": { poverty: 50.6, extreme: 8.4, population: 800000, urban: 40, group: "B" },
            "Izabal": { poverty: 50.5, extreme: 14.9, population: 400000, urban: 50, group: "B" },
            "Chimaltenango": { poverty: 47.8, extreme: 5.8, population: 630000, urban: 50, group: "B" },
            "El Progreso": { poverty: 46.4, extreme: 5.1, population: 180000, urban: 40, group: "B" },
            "Quetzaltenango": { poverty: 44.1, extreme: 2.8, population: 800000, urban: 60, group: "C" },
            "Escuintla": { poverty: 39.2, extreme: 2.6, population: 700000, urban: 75, group: "C" },
            "Sacatep√©quez": { poverty: 38.7, extreme: 2.5, population: 320000, urban: 80, group: "C" },
            "Guatemala": { poverty: 21.6, extreme: 1.1, population: 3200000, urban: 95, group: "C" }
        };

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');

            if (tab === 'departments') loadDepartments();
            if (tab === 'families') loadFamilyTypes();
            if (tab === 'solutions') loadSolutions();
        }

        function loadDepartments() {
            const groupA = document.getElementById('group-a');
            const groupB = document.getElementById('group-b');
            const groupC = document.getElementById('group-c');
            groupA.innerHTML = '';
            groupB.innerHTML = '';
            groupC.innerHTML = '';

            Object.entries(departmentsData).forEach(([name, data]) => {
                const card = `
                    <div class="card" onclick="showDepartmentDetail('${name}')">
                        <div class="badge">${data.group === 'A' ? 'üî¥ GRUPO A' : data.group === 'B' ? 'üü† GRUPO B' : 'üü¢ GRUPO C'}</div>
                        <h4>${name}</h4>
                        <p><strong>Pobreza:</strong> ${data.poverty}% | <strong>Extrema:</strong> ${data.extreme}%</p>
                        <p><strong>Poblaci√≥n:</strong> ${(data.population/1000000).toFixed(1)}M | <strong>Urbano:</strong> ${data.urban}%</p>
                    </div>
                `;
                if (data.group === 'A') groupA.innerHTML += card;
                else if (data.group === 'B') groupB.innerHTML += card;
                else groupC.innerHTML += card;
            });
        }

        function loadFamilyTypes() {
            const container = document.getElementById('family-types');
            const families = [
                { name: "Pobreza Extrema Rural", income: "< Q1,500", type: "rural", color: "#e74c3c" },
                { name: "Pobre Urbana Informal", income: "Q2,500-3,500", type: "urban", color: "#f39c12" },
                { name: "Clase Trabajadora Formal", income: "Q4,500-7,000", type: "formal", color: "#3498db" },
                { name: "Clase Media Emergente", income: "Q7,000-12,000", type: "middle", color: "#27ae60" }
            ];
            
            container.innerHTML = families.map(f => `
                <div class="card" onclick="showFamilyDetail('${f.type}')" style="border-left: 4px solid ${f.color};">
                    <h4>${f.name}</h4>
                    <p><strong>Ingreso mensual:</strong> ${f.income}</p>
                    <p style="color: ${f.color}; font-weight: 600; margin-top: 10px;">Ver soluci√≥n personalizada ‚Üí</p>
                </div>
            `).join('');
        }

        function loadSolutions() {
            const container = document.getElementById('solutions-grid');
            const solutions = [
                { name: "N√∫cleos M√≠nimos + Progresiva", desc: "Para pobreza extrema rural", cost: "Q84-140k", time: "10 a√±os" },
                { name: "Lotes con Servicios", desc: "Para pobre urbana", cost: "Q280k", time: "3-5 a√±os" },
                { name: "Vivienda Econ√≥mica Hipotecaria", desc: "Para clase trabajadora", cost: "Q280-445k", time: "20-25 a√±os" },
                { name: "Vivienda Vertical PPP", desc: "Para clase media urbana", cost: "Q600-900k", time: "25 a√±os" }
            ];

            container.innerHTML = solutions.map(s => `
                <div class="card">
                    <h4>${s.name}</h4>
                    <p>${s.desc}</p>
                    <div style="margin-top: 10px;">
                        <span class="metric">üí∞ ${s.cost}</span>
                        <span class="metric">‚è±Ô∏è ${s.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // Soluciones innovadoras por tipo de familia
        const allSolutions = [
            // TIPO 1: POBREZA EXTREMA RURAL
            {
                id: 1, name: 'N√∫cleos Progresivos', family: 'Pobreza Extrema Rural', color: '#e74c3c',
                consiste: 'Familia en suelo comunal/familiar. Subsidio Q59k + cr√©dito Q24k sin inter√©s. Construye 35m¬≤ a√±o 1, expande 10 a√±os a 70m¬≤.',
                gobierno: ['Mapear suelo comunal', 'Legalizar usufructo perpetuo', 'Desembolsar Q59k subsidio', 'Desembolsar Q24k cr√©dito en 3 tranches', '1 t√©cnico por 50 familias'],
                timeline_gov: 'T1-T3 2026',
                cost_gov: 'Q83k por familia',
                familia: ['Ingreso <Q1,500/mes', 'Acceso a suelo', 'N√∫cleo familiar constituido'],
                acciones: ['Limpiar terreno mes 1-3', 'Construir 35m¬≤ mes 3-12', 'Expandir progresivamente a√±os 2-10'],
                compromiso: 'Residencia 5 a√±os + 24 jornadas trabajo comunitario'
            },
            {
                id: 2, name: 'Cooperativa Autofondaci√≥n', family: 'Pobreza Extrema Rural', color: '#e74c3c',
                consiste: '50 familias forman cooperativa. Ahorran Q200/mes (Q2,400 x 12m). Fondo colectivo Q120k. Banco financia 80% @ 2%.',
                gobierno: ['Facilitar formaci√≥n cooperativa legal', 'Negociar con banca @ 2%', 'Desembolsar Q59k subsidio x 50 familias', 'Capacitar junta directiva 12 horas'],
                timeline_gov: 'T1 2026: formaci√≥n | T4 2027: construcci√≥n',
                cost_gov: 'Q59k subsidio + Q192k cr√©dito por familia',
                familia: ['Ahorrar Q200/mes sin falta', 'Participar 80%+ asambleas', 'Grupo 50 familias coordinadas'],
                acciones: ['Ahorrar 12 meses Q200/mes', 'Participar capacitaci√≥n construcci√≥n', 'Construcci√≥n participativa fin de semana'],
                compromiso: 'Ahorro disciplinado + 60+ jornadas construcci√≥n + pago Q300/mes 20 a√±os'
            },
            {
                id: 3, name: 'Mejoramiento Acelerado Piso', family: 'Pobreza Extrema Rural', color: '#e74c3c',
                consiste: 'Familia tiene techo+paredes. Financia concreto Q6k + ba√±o Q4k + techo Q5k = Q15k total. Impacto 3-6 meses.',
                gobierno: ['Diagn√≥stico viviendas precarias', 'Capacitar 100 maestros de obra', 'Comprar materiales a escala', 'Distribuir por municipios', 'Supervisar calidad mensual'],
                timeline_gov: 'T1-T2 2026: capacitaci√≥n | T3 2026+: distribuci√≥n',
                cost_gov: 'Q15k materiales por familia',
                familia: ['Vivienda preexistente (techo+paredes)', 'Terreno propiedad/usufructo', 'Capacidad aportar mano de obra'],
                acciones: ['Solicitar municipio', 'Preparar terreno', 'Construcci√≥n piso 4-6 semanas', 'Instalaci√≥n ba√±o 2-3 semanas'],
                compromiso: '40+ jornadas trabajo comunitario + mantenimiento permanente'
            },
            {
                id: 4, name: 'Usufructo Perpetuo Municipal', family: 'Pobreza Extrema Rural', color: '#e74c3c',
                consiste: 'Municipio cede derecho construcci√≥n 50 a√±os (NO compra). Familia construye progresiva. A√±o 50: vivienda patrimonio familiar.',
                gobierno: ['Identificar suelo municipal disponible', 'Catastro + escrituras usufructo', 'Firmar contratos familias', 'Proporcionar servicios b√°sicos', 'Renovar contrato cada 10 a√±os'],
                timeline_gov: 'T1-T4 2026',
                cost_gov: 'Q59k subsidio + Q24k cr√©dito + Q15k servicios = Q98k',
                familia: ['Ingresos <Q1,500/mes', 'Aceptar ubicaci√≥n perif√©rica', 'Residencia 5 a√±os'],
                acciones: ['Solicitar lote municipio', 'Firmar contrato usufructo 50 a√±os', 'Construcci√≥n progresiva a√±os 1-10', 'Renovar contrato a√±o 10'],
                compromiso: 'Residencia 5 a√±os + pagos servicios Q15/mes agua + participaci√≥n comunitaria'
            },
            // TIPO 2: POBRE URBANA INFORMAL
            {
                id: 5, name: 'Lotes Urbanizados', family: 'Pobre Urbana Informal', color: '#f39c12',
                consiste: 'Municipio compra 50-100 ha. Urbaniza (calles, agua, alcantarilla, electricidad). Vende lotes Q150-200/m¬≤ (mercado Q400-600/m¬≤).',
                gobierno: ['Adquirir suelo municipal', 'Urbanizaci√≥n b√°sica', 'Vender lotes precio costo', 'Desembolsar subsidio FOPAVI Q35k por familia'],
                timeline_gov: 'T1-T3 2026',
                cost_gov: 'Q53-59k por familia (lote Q18-24k + subsidio Q35k)',
                familia: ['Ingresos Q2,500-3,500/mes', 'Ahorros Q5k m√≠nimos', 'Capacidad pagar lote 5 a√±os'],
                acciones: ['Solicitar lote municipio', 'Financiar Q400-500/mes 5 a√±os', 'Obtener subsidio Q35k', 'Construir 70m¬≤ a√±o 1-2', 'Ampliar 90m¬≤ a√±os 2-3'],
                compromiso: 'Cuota lote Q400-500/mes + participaci√≥n trabajo + residencia 5 a√±os'
            },
            {
                id: 6, name: 'Reurbanizaci√≥n In Situ', family: 'Pobre Urbana Informal', color: '#f39c12',
                consiste: 'Invasi√≥n se legaliza. Titulaci√≥n familias. Edificio 3-5 pisos: pisos 1-2 pobres (subsidio), pisos 3-5 clase media (pagan).',
                gobierno: ['Negociar legalizaci√≥n', 'Catastro + titulaci√≥n', 'Invitar desarrollador PPP', 'Desembolsar Q35k x pobres', 'Garantizar servicios + cero desalojos'],
                timeline_gov: 'T1 2026: negociaci√≥n | T2 2026: catastro | T3-T4 2026: construcci√≥n',
                cost_gov: 'Q45k por familia pobre (subsidio Q35k + servicios Q10k)',
                familia: ['Residencia 5+ a√±os demostrables', 'Ingresos Q2,500-3,500/mes', 'Participaci√≥n 100% legal'],
                acciones: ['Inscribirse regularizaci√≥n', 'Certificaci√≥n residencia (6m)', 'Obtener t√≠tulo propiedad', 'Solicitar subsidio Q35k', 'Mudanza piso 1', 'Pagar hipotecario si aplica'],
                compromiso: 'Residencia 10 a√±os + participaci√≥n legal + cuota condominio Q200-300/mes + no reventa 5 a√±os'
            },
            {
                id: 7, name: 'Alquiler ‚Üí Compra', family: 'Pobre Urbana Informal', color: '#f39c12',
                consiste: 'Estado construye edificios. Familias alquilan Q800-1,000/mes x 10 a√±os. 30% cuota = capital compra. A√±o 10: opci√≥n compra residual Q40-50k.',
                gobierno: ['Construir edificios 4-6 pisos (BM)', 'Contratos alquiler-venta 10 a√±os', 'Mantener edificios', 'Subsidio Q20k reducci√≥n cuota', 'Fondo garant√≠a desempleo Q10k'],
                timeline_gov: '2026-2027: construcci√≥n | 2027: alquiler | 2037: opci√≥n compra',
                cost_gov: 'Construcci√≥n Q250-300k (amortizable 30 a√±os) + subsidio Q20k',
                familia: ['Ingresos Q2,500-3,500/mes estables', 'Capacidad pagar Q950/mes', 'Commitment 10 a√±os edificio'],
                acciones: ['Solicitar programa + aprobaci√≥n', 'Mudanza alquilada', 'Pagar alquiler Q800/mes x 10 a√±os', 'Acumular capital Q36k', 'A√±o 10: opci√≥n compra'],
                compromiso: 'Residencia 10 a√±os + pago religioso alquiler + cuidado vivienda'
            },
            {
                id: 8, name: 'Microfinanciamiento Garantizado', family: 'Pobre Urbana Informal', color: '#f39c12',
                consiste: 'Banca comercial financia Q150-200k a 15 a√±os @ 6-7%. Estado garantiza 30% riesgo. Acceso DIRECTO sin FOPAVI (2-3 meses).',
                gobierno: ['Negociar con bancos garant√≠a 30%', 'Crear fondo garant√≠a Q100M', 'Capacitar oficiales bancarios', 'Facilitar aprobaci√≥n 60 d√≠as', 'Supervisar tasas <7%'],
                timeline_gov: 'T1-T2 2026: negociaci√≥n | T3 2026+: cr√©ditos',
                cost_gov: 'Garant√≠a estatal Q50-60k (30% riesgo) por familia',
                familia: ['Ingresos Q2,500-3,500/mes demostrables', 'Sin historial morosidad', 'Cuota Q1,200-1,500/mes sostenible'],
                acciones: ['Solicitar banco + documentos', 'Evaluaci√≥n crediticia (64 puntos)', 'Aprobaci√≥n 1-2 meses', 'Desembolso directo', 'Construcci√≥n 3-24 meses', 'Pagos Q1,200-1,500/mes 15-20 a√±os'],
                compromiso: 'Cumplimiento puntual (default = exclusi√≥n 7 a√±os) + construcci√≥n responsable'
            },
            // TIPO 3: CLASE TRABAJADORA FORMAL
            {
                id: 9, name: 'Hipotecario + Subsidio Focal', family: 'Clase Trabajadora Formal', color: '#3498db',
                consiste: 'Familia ahorra Q25k. FOPAVI Q35k (30% enganche). Banco Q310k a 25 a√±os @ 8.5%. Cuota Q2,140/mes (30% ingreso Q4,500-7,000).',
                gobierno: ['Negociar bancos tasa 8.5%', 'Desembolsar Q35k directo a banco', 'Facilitar aprobaci√≥n 30 d√≠as', 'Fondo garant√≠a Q10k desempleo'],
                timeline_gov: 'T1 2026: negociaci√≥n | T2 2026: l√≠nea | T3 2026+: desembolsos',
                cost_gov: 'Subsidio FOPAVI Q35k + cr√©dito Q310k (familia paga)',
                familia: ['Ingresos Q4,500-7,000/mes estables formales (2+ a√±os)', 'Ahorros Q25k demostrados (6+ meses)', 'Sin deudas vencidas', 'N√∫cleo familiar constituido'],
                acciones: ['Ahorrar Q4-5k/mes 6 meses', 'Solicitar subsidio FOPAVI', 'Solicitar hipotecario banco', 'Aprobaci√≥n 30 d√≠as', 'B√∫squeda vivienda Q345-400k', 'Desembolso (Q35k+Q310k)', 'Pagos Q2,140/mes 25 a√±os'],
                compromiso: 'Ahorro previo + estabilidad laboral + pago puntual Q2,140/mes'
            },
            {
                id: 10, name: 'Condominio Solidario', family: 'Clase Trabajadora Formal', color: '#3498db',
                consiste: '100-150 viviendas: 40% pobres (FOPAVI Q35k) + 60% clase media (precio mercado). Arquitectura integrada. Espacios comunes compartidos.',
                gobierno: ['Identificar desarrollador', 'Financiar Q35k x 40-60 pobres', 'Regular precio m√°ximo media', 'Supervisar mixtura social', 'Financiar espacios Q20-30M'],
                timeline_gov: 'T1 2026: identificaci√≥n | T2-T4 2026: construcci√≥n',
                cost_gov: 'Subsidio Q35k (pobres) + hipotecario Q200-300k (trabajadores)',
                familia: ['Ingresos Q4,500-7,000/mes estables', 'Ahorros Q20-30k enganche', 'Aceptaci√≥n mixtura social', 'Participaci√≥n junta condominal'],
                acciones: ['Inscribirse sorteo viviendas', 'Ahorrar Q20-30k', 'Solicitar subsidio Q35k', 'Aprobaci√≥n hipotecario Q200-300k', 'Entrega llaves + mudanza', 'Pagos Q1,300-1,500/mes + condominio Q300-400/mes'],
                compromiso: 'Pago Q1,600-1,900/mes + participaci√≥n junta + cuidado √°reas + no venta 5 a√±os'
            },
            {
                id: 11, name: 'Cooperativa Inmobiliaria', family: 'Clase Trabajadora Formal', color: '#3498db',
                consiste: '100 trabajadores forman cooperativa. Compran terreno (econom√≠a escala). Contratan constructor. Venden sin ganancia especulativa (Q280-350k vs Q400-500k mercado).',
                gobierno: ['Asesor√≠a legal cooperativa gratis', 'Desembolsar Q35k x 40-50 familias', 'Facilitar cr√©dito colectivo @ 5%', 'Capacitaci√≥n 12 horas', 'Asesor√≠a ingeniero 4 sesiones'],
                timeline_gov: 'T1-T4 2026',
                cost_gov: 'Subsidio Q35k + cr√©dito 5% + ahorros Q30-50k por familia',
                familia: ['Ingresos Q4,500-7,000/mes', 'Grupo 100 trabajadores', 'Ahorrar Q500-1,000/mes x 12 meses', 'Participaci√≥n 100% asambleas', 'Aceptaci√≥n construcci√≥n progresiva'],
                acciones: ['Organizar 100 personas', 'Formar junta directiva', 'Constituci√≥n cooperativa legal (3m)', 'Ahorros colectivos 6 meses', 'Compra terreno grupal', 'Dise√±o arquitect√≥nico', 'Construcci√≥n 3 fases (8 meses c/30 viviendas)', 'Pagos Q1,200-1,500/mes 20 a√±os'],
                compromiso: 'Ahorro Q500-1,000/mes x 12 + participaci√≥n 100% + 30+ jornadas voluntarias + roles rotativos junta'
            },
            {
                id: 12, name: 'Financiamiento H√≠brido', family: 'Clase Trabajadora Formal', color: '#3498db',
                consiste: 'Familia ahorra Q500/mes x 24 meses (Q12k). Subsidio FOPAVI Q35k + cr√©dito Q300k @ 8% = Q347k. Ahorro + subsidio = 40%, cr√©dito = 60%.',
                gobierno: ['Abrir cuentas ahorro especial (5% tasa)', 'Desembolsar Q35k al completar 24 meses', 'Facilitar hipotecario Q300k', 'Bonificaci√≥n si ahorro > Q12k', 'Seguimiento mensual'],
                timeline_gov: 'T1 2026: cuentas | Meses 1-24: ahorro | Meses 24-26: hipotecario',
                cost_gov: 'Subsidio Q35k + ahorro Q12k = Q47k inicial | Cr√©dito Q300k @ 8%',
                familia: ['Ingresos Q4,500-7,000/mes formales', 'Disciplina ahorro Q500/mes x 24 sin falta', 'Cuenta bancaria con dep√≥sitos demostrables', 'Sin deudas vencidas'],
                acciones: ['Abrir cuenta ahorro especial', 'Dep√≥sito Q500/mes x 24 meses', 'Revisi√≥n cumplimiento mes 12', 'Completar Q12k + solicitar subsidio mes 24', 'Aprobaci√≥n hipotecario Q300k', 'Desembolso Q347k mes 26', 'Construcci√≥n 100m¬≤ (meses 26-40)', 'Pagos Q1,600/mes 20 a√±os'],
                compromiso: 'Ahorro religioso Q500/mes x 24 + pago Q1,600/mes 20 a√±os'
            },
            // TIPO 4: CLASE MEDIA EMERGENTE
            {
                id: 13, name: 'Garant√≠a Estatal Parcial', family: 'Clase Media Emergente', color: '#27ae60',
                consiste: 'Estado garantiza 20-30% riesgo. Banco reduce tasa 10-12% a 7.5-8.5%. Acceso hipotecario competitivo sin subsidio directo. Q600-900k.',
                gobierno: ['Negociar reducci√≥n tasa via garant√≠a', 'Crear fondo garant√≠a Q200M', 'Supervisar tasas max 8.5%', 'Facilitar aprobaci√≥n acelerada'],
                timeline_gov: 'T1 2026: negociaci√≥n | T2 2026+: cr√©ditos',
                cost_gov: 'Garant√≠a estatal Q120-270k (20-30% riesgo) por familia',
                familia: ['Ingresos Q7,000-12,000/mes demostrables', 'Ahorros Q150-200k enganche', 'Sin deudas vencidas', 'Historial crediticio limpio'],
                acciones: ['Solicitar garant√≠a estatal banco', 'Aprobaci√≥n 15-30 d√≠as', 'Hipotecario Q600-900k @ 7.5-8.5%', 'Cuota Q2,740-4,100/mes x 25 a√±os', 'B√∫squeda + compra vivienda', 'Pagos sistem√°ticos'],
                compromiso: 'Pago puntual Q2,740-4,100/mes + mantenimiento vivienda'
            },
            {
                id: 14, name: 'Vivienda Vertical Mixta PPP', family: 'Clase Media Emergente', color: '#27ae60',
                consiste: '30% pobre + 70% clase media. Municipio aporta suelo. Privado construye 6-8 pisos. Pisos 1-2 = subsidio cruzado. Pisos 3-8 = precio mercado.',
                gobierno: ['Proporcionar suelo municipal', 'Regularizaci√≥n legal suelo', 'Facilitar PPP con privado', 'Desembolsar Q35k x pobres', 'Supervisar mixtura social', 'Equipamiento comunitario'],
                timeline_gov: 'T1-T2 2026: suelo | T2-T3 2026: PPP | T4 2026-T2 2028: construcci√≥n',
                cost_gov: 'Subsidio Q35k (pobres) + suelo Q80-120k + equipamiento',
                familia: ['Ingresos Q7,000-12,000/mes', 'Ahorros Q100-150k enganche', 'Aceptaci√≥n mixtura social', 'Participaci√≥n condominio'],
                acciones: ['Inscribirse proyecto', 'Ahorrar Q100-150k', 'Hipotecario Q400-800k', 'Aprobaci√≥n 30-60 d√≠as', 'Ocupaci√≥n a√±o 2-3', 'Pagos Q2,000-3,500/mes + condominio Q400-500/mes'],
                compromiso: 'Pago puntual + no venta 5 a√±os + participaci√≥n condominio + respeto mixtura'
            },
            {
                id: 15, name: 'Fideicomiso Rendimiento', family: 'Clase Media Emergente', color: '#27ae60',
                consiste: 'Familia invierte Q100-150k en fideicomiso (compra vivienda). Habita con alquiler interno bajo. Retira rendimientos a√±o 15+. Doble: vivienda + inversi√≥n.',
                gobierno: ['Facilitar fideicomisos privados', 'Supervisar transparencia', 'Garant√≠a seguridad jur√≠dica', 'Facilidades fiscales'],
                timeline_gov: 'T1 2026: dise√±o | T2 2026+: operaci√≥n',
                cost_gov: 'Inversi√≥n familia Q100-150k (se recupera 15-20 a√±os)',
                familia: ['Ingresos Q7,000-12,000/mes', 'Capital invertible Q100-150k', 'Disposici√≥n 15+ a√±os', 'Aceptaci√≥n riesgo inversi√≥n'],
                acciones: ['Abrir fideicomiso', 'Dep√≥sito Q100-150k', 'Fideicomiso compra vivienda', 'Familia ocupa (alquiler Q500-800/mes)', 'A√±os 1-15: rendimientos', 'A√±o 15+: retiro capital + ganancias'],
                compromiso: 'Commitment 15+ a√±os + pago alquiler interno + participaci√≥n decisiones'
            },
            {
                id: 16, name: 'Densificaci√≥n + Airbnb', family: 'Clase Media Emergente', color: '#27ae60',
                consiste: 'Familia construye 2 unidades en terreno. Habita 1, alquila Airbnb Q1,500-2,500/mes. Ingreso pasivo reduce/elimina cuota. Vivienda gratis 5-8 a√±os.',
                gobierno: ['Permitir densificaci√≥n (2 unidades)', 'Regulaci√≥n Airbnb responsable', 'Incentivos fiscales (0% IVA materiales)', 'L√≠nea cr√©dito duplicaci√≥n'],
                timeline_gov: 'T1 2026: regulaci√≥n | T2 2026+: proyectos',
                cost_gov: 'Cr√©dito Q600-1,000k @ 8% / 25 a√±os (ambas unidades)',
                familia: ['Ingresos Q7,000-12,000/mes', 'Capital Q200-300k primera unidad', 'Disposici√≥n gestionar Airbnb', 'Ubicaci√≥n estrat√©gica (turismo)'],
                acciones: ['Comprar terreno Q200-300k', 'Construir 2 unidades Q600-1,000k', 'Habitar unidad 1, alquilar unidad 2 Airbnb', 'Ingreso Q1,500-2,500/mes reduce cuota', 'A√±o 5-8: pago completo'],
                compromiso: 'Gesti√≥n Airbnb activa + mantenimiento ambas + cumplimiento regulaciones turismo'
            }
        ];

        function filterMatrixSolutions() {
            const filter = document.getElementById('family-filter').value;
            const matrixGrid = document.getElementById('matrix-grid');
            matrixGrid.innerHTML = '';

            const filtered = filter ? allSolutions.filter(s => s.family === filter) : allSolutions;

            filtered.forEach(sol => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.borderLeft = `4px solid ${sol.color}`;
                card.innerHTML = `
                    <div class="badge" style="background: ${sol.color};">${sol.family}</div>
                    <h4>${sol.name}</h4>
                    <p><strong>¬øQU√â CONSISTE:</strong> ${sol.consiste}</p>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <p style="margin: 8px 0; font-size: 0.9em;"><strong style="color: ${sol.color};">COSTO:</strong> ${sol.cost_gov}</p>
                        <p style="margin: 8px 0; font-size: 0.9em;"><strong style="color: ${sol.color};">TIMELINE:</strong> ${sol.timeline_gov}</p>
                    </div>
                    <button onclick="showSolutionDetail(${sol.id})" style="width: 100%; margin-top: 15px; background: ${sol.color};">Ver Detalles Completos ‚Üí</button>
                `;
                matrixGrid.appendChild(card);
            });
        }

        function showSolutionDetail(solutionId) {
            const sol = allSolutions.find(s => s.id === solutionId);
            if (!sol) return;

            const govHTML = `
                <h4 style="color: ${sol.color}; margin-top: 15px;">üèõÔ∏è QU√â DEBE HACER GOBIERNO</h4>
                <ul style="margin-left: 20px; color: #666;">
                    ${sol.gobierno.map(a => `<li>${a}</li>`).join('')}
                </ul>
                <p><strong>Timeline:</strong> ${sol.timeline_gov}</p>
                <p><strong>Presupuesto por familia:</strong> ${sol.cost_gov}</p>
            `;

            const familyReqHTML = `
                <h4 style="color: ${sol.color}; margin-top: 15px;">‚úÖ REQUISITOS FAMILIA</h4>
                <ul style="margin-left: 20px; color: #666;">
                    ${sol.familia.map(r => `<li>${r}</li>`).join('')}
                </ul>
            `;

            const familyActHTML = `
                <h4 style="color: ${sol.color}; margin-top: 15px;">üìã ACCIONES FAMILIA</h4>
                <ul style="margin-left: 20px; color: #666;">
                    ${sol.acciones.map(a => `<li>${a}</li>`).join('')}
                </ul>
            `;

            const commitHTML = `
                <div style="background: ${sol.color}; color: white; padding: 12px; border-radius: 6px; margin-top: 15px;">
                    <strong>üí™ COMPROMISO FAMILIA:</strong><br>
                    ${sol.compromiso}
                </div>
            `;

            const html = `
                <h3>${sol.name}</h3>
                <div class="badge" style="background: ${sol.color}; margin-bottom: 15px;">${sol.family}</div>
                <p><strong>¬øQU√â CONSISTE EXACTAMENTE?</strong></p>
                <p style="color: #333; line-height: 1.8;">${sol.consiste}</p>
                ${govHTML}
                ${familyReqHTML}
                ${familyActHTML}
                ${commitHTML}
            `;

            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('show');
        }

        const innovativeSolutions = {
            'extreme-rural': allSolutions.filter(s => s.family === 'Pobreza Extrema Rural').map(s => ({
                name: s.name, mechanism: s.consiste, advantage: s.compromiso, cost: s.cost_gov, timeline: s.timeline_gov
            })),
            'poor-urban': allSolutions.filter(s => s.family === 'Pobre Urbana Informal').map(s => ({
                name: s.name, mechanism: s.consiste, advantage: s.compromiso, cost: s.cost_gov, timeline: s.timeline_gov
            })),
            'working-class': allSolutions.filter(s => s.family === 'Clase Trabajadora Formal').map(s => ({
                name: s.name, mechanism: s.consiste, advantage: s.compromiso, cost: s.cost_gov, timeline: s.timeline_gov
            })),
            'middle-class': allSolutions.filter(s => s.family === 'Clase Media Emergente').map(s => ({
                name: s.name, mechanism: s.consiste, advantage: s.compromiso, cost: s.cost_gov, timeline: s.timeline_gov
            }))
        };

        function calculateSolution() {
            const dept = document.getElementById('department').value;
            const familyType = document.getElementById('family-type').value;
            const income = parseInt(document.getElementById('monthly-income').value);
            const size = document.getElementById('family-size').value;
            const location = document.getElementById('location').value;

            if (!dept || !familyType || !income) {
                alert('Por favor completa todos los campos');
                return;
            }

            const deptData = departmentsData[dept];
            const fopavi = 59000;
            const minSalary = 4252;
            const dwellingType = familyType === 'extreme-rural' ? 'nucleos_minimos' : 'standard';
            const costs = {
                nucleos_minimos: 84000,
                economic: 280000,
                social: 445000,
                standard: 720000
            };

            const totalCost = costs[dwellingType === 'nucleos_minimos' ? 'nucleos_minimos' : familyType === 'poor-urban' ? 'economic' : familyType === 'working-class' ? 'social' : 'standard'];
            const monthlyPayment = Math.max(0, (totalCost - fopavi) / 240);
            const paymentPercent = (monthlyPayment / income) * 100;

            let solution = '';
            if (paymentPercent > 35) {
                solution = `<div class="warning"><strong>‚ö†Ô∏è Alerta Financiera:</strong> La cuota estimada (Q${monthlyPayment.toFixed(0)}/mes = ${paymentPercent.toFixed(1)}% ingreso) excede lo recomendado (30%). Se necesita cr√©dito subvencionado o vivienda m√°s peque√±a.</div>`;
            } else {
                solution = `<div class="success"><strong>‚úÖ Viable:</strong> Puedes acceder con subsidio FOPAVI + cr√©dito complementario.</div>`;
            }

            // Obtener soluciones innovadoras
            const solutions = innovativeSolutions[familyType] || [];
            let solutionsHtml = '<h3 style="margin-top: 20px; color: #667eea;">üí° 4 Soluciones Innovadoras para Ti:</h3>';
            solutions.forEach((sol, idx) => {
                solutionsHtml += `
                    <div style="background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 3px solid #667eea;">
                        <strong>${idx + 1}. ${sol.name}</strong>
                        <p style="margin: 8px 0 0 0; color: #666; font-size: 0.9em;"><strong>Mecanismo:</strong> ${sol.mechanism}</p>
                        <p style="margin: 5px 0; color: #666; font-size: 0.9em;"><strong>Ventaja:</strong> ${sol.advantage}</p>
                        <p style="margin: 5px 0; color: #666; font-size: 0.9em;"><strong>Costo:</strong> ${sol.cost} | <strong>Timeline:</strong> ${sol.timeline}</p>
                    </div>
                `;
            });

            const html = `
                <div class="result-item">
                    <strong>Departamento:</strong> ${dept} (Pobreza: ${deptData.poverty}%)
                </div>
                <div class="result-item">
                    <strong>Tipo de Vivienda Est√°ndar:</strong> ${familyType === 'extreme-rural' ? 'N√∫cleo M√≠nimo Rural' : familyType === 'poor-urban' ? 'Econ√≥mica Urbana' : 'Social/Est√°ndar'}
                </div>
                <div class="result-item">
                    <strong>Costo Total Estimado:</strong> Q${totalCost.toLocaleString()}
                </div>
                <div class="result-item">
                    <strong>Subsidio FOPAVI:</strong> Q${fopavi.toLocaleString()} (${((fopavi/totalCost)*100).toFixed(1)}%)
                </div>
                <div class="result-item">
                    <strong>Cr√©dito Requerido:</strong> Q${(totalCost - fopavi).toLocaleString()}
                </div>
                <div class="result-item">
                    <strong>Cuota Mensual Estimada:</strong> Q${monthlyPayment.toFixed(0)} (${paymentPercent.toFixed(1)}% de ingreso)
                </div>
                ${solution}
                ${solutionsHtml}
            `;

            document.getElementById('result-content').innerHTML = html;
            document.getElementById('result').classList.add('show');
        }

        function showDepartmentDetail(dept) {
            const data = departmentsData[dept];
            const html = `
                <h3>${dept}</h3>
                <table style="width: 100%; margin-top: 15px;">
                    <tr><td><strong>Tasa de Pobreza Total</strong></td><td>${data.poverty}%</td></tr>
                    <tr><td><strong>Tasa de Pobreza Extrema</strong></td><td>${data.extreme}%</td></tr>
                    <tr><td><strong>Poblaci√≥n Total</strong></td><td>${(data.population/1000000).toFixed(1)} millones</td></tr>
                    <tr><td><strong>Poblaci√≥n Urbana</strong></td><td>${data.urban}%</td></tr>
                </table>
                <div style="margin-top: 20px;">
                    <strong>Estrategia Recomendada:</strong><br>
                    ${data.group === 'A' ? 'N√∫cleos m√≠nimos + cooperativas + suelo comunal' : data.group === 'B' ? 'Lotes urbanizados + hipotecario + subsidio' : 'Vivienda vertical + PPP + regulaci√≥n urbana'}
                </div>
            `;
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('show');
        }

        function showFamilyDetail(type) {
            const details = {
                rural: {
                    title: "Pobreza Extrema Rural",
                    income: "< Q1,500/mes",
                    vivienda: "N√∫cleo m√≠nimo (35 m¬≤, Q84,000 total)",
                    subsidio: "Q59,000 (70%)",
                    credito: "Q24,000 sin inter√©s (10 a√±os)",
                    aporte: "Q1,000 + trabajo comunitario",
                    tiempo: "10 a√±os (progresiva)"
                },
                urban: {
                    title: "Pobre Urbana Informal",
                    income: "Q2,500-3,500/mes",
                    vivienda: "Econ√≥mica urbana (70 m¬≤, Q280,000 total)",
                    subsidio: "Q35,000",
                    credito: "Q200,000 @ 8% / 20 a√±os = Q1,250/mes",
                    aporte: "Q45,000 lote + servicios",
                    tiempo: "3-5 a√±os construcci√≥n"
                },
                formal: {
                    title: "Clase Trabajadora Formal",
                    income: "Q4,500-7,000/mes",
                    vivienda: "Social (95 m¬≤, Q445,000 total)",
                    subsidio: "Q35,000",
                    credito: "Q390,000 @ 8.5% / 25 a√±os = Q2,140/mes (30% ingreso)",
                    aporte: "Q20,000 enganche",
                    tiempo: "25 a√±os"
                },
                middle: {
                    title: "Clase Media Emergente",
                    income: "Q7,000-12,000/mes",
                    vivienda: "Est√°ndar (120-150 m¬≤, Q600-900k)",
                    subsidio: "Opcional 0-20k",
                    credito: "Q500-750k @ 8% / 25 a√±os = Q2,740-4,100/mes",
                    aporte: "Q150-200k enganche",
                    tiempo: "25 a√±os"
                }
            };

            const d = details[type];
            const html = `
                <h3>${d.title}</h3>
                <table style="width: 100%; margin-top: 15px;">
                    <tr><td><strong>Ingreso Mensual</strong></td><td>${d.income}</td></tr>
                    <tr><td><strong>Tipo de Vivienda</strong></td><td>${d.vivienda}</td></tr>
                    <tr><td><strong>Subsidio FOPAVI</strong></td><td>${d.subsidio}</td></tr>
                    <tr><td><strong>Cr√©dito</strong></td><td>${d.credito}</td></tr>
                    <tr><td><strong>Aporte Familia</strong></td><td>${d.aporte}</td></tr>
                    <tr><td><strong>Plazo</strong></td><td>${d.tiempo}</td></tr>
                </table>
            `;
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function downloadDocument(type) {
            let content = '';
            let filename = '';
            
            if (type === 'estrategia') {
                content = `SISTEMA DE INTELIGENCIA PRUDENCIAL PARA VIVIENDA EN GUATEMALA
Aplicando "Ni magia ni m√©todo" de Moris Polanco

I. FUNDAMENTO FILOS√ìFICO
Este sistema aplica cuatro principios del pensamiento de Polanco:

1. LA T√ìPICA (Arist√≥teles)
Usamos "lugares" para interrogar cada contexto:
- Definici√≥n: ¬øQu√© tipo de vivienda se necesita?
- G√©nero: ¬øUrbano o rural?
- Causa: ¬øPor qu√© existe el d√©ficit?
- Comparaci√≥n: ¬øQu√© funciona en otros departamentos?
- Tiempo: ¬øCu√°l es el kairos (momento oportuno)?

2. LA PRUDENCIA (Graci√°n)
No una soluci√≥n √∫nica. Adaptamos seg√∫n contexto:
- Observaci√≥n del contexto
- Variaci√≥n de la conducta
- Sentido de la ocasi√≥n

3. LA ABDUCCI√ìN (Peirce)
Conjetura inteligente: Anomal√≠a ‚Üí Hip√≥tesis ‚Üí Verificaci√≥n

4. EL KAIROS (Tiempo Oportuno)
Identificamos la ventana actual (2026), punto de presi√≥n (Grupo A >80% pobreza), saz√≥n de las cosas.

II. SOLUCIONES POR TIPO DE FAMILIA

TIPO 1: Pobreza Extrema Rural (<Q1,500/mes)
- Vivienda: N√∫cleo m√≠nimo (35 m¬≤)
- Costo total: Q84,000
- Subsidio FOPAVI: Q59,000 (70%)
- Cr√©dito: Q24,000 sin inter√©s (10 a√±os)
- Aporte familia: Q1,000 + trabajo comunitario
- Plazo: 10 a√±os (progresiva)

TIPO 2: Pobre Urbana Informal (Q2,500-3,500/mes)
- Vivienda: Econ√≥mica urbana (70 m¬≤)
- Costo total: Q280,000
- Subsidio FOPAVI: Q35,000
- Cr√©dito: Q200,000 @ 8% / 20 a√±os = Q1,250/mes
- Plazo: 3-5 a√±os construcci√≥n

TIPO 3: Clase Trabajadora Formal (Q4,500-7,000/mes)
- Vivienda: Social (95 m¬≤)
- Costo total: Q445,000
- Subsidio FOPAVI: Q35,000
- Cr√©dito: Q390,000 @ 8.5% / 25 a√±os = Q2,140/mes
- Plazo: 25 a√±os

TIPO 4: Clase Media Emergente (Q7,000-12,000/mes)
- Vivienda: Est√°ndar (120-150 m¬≤)
- Costo total: Q600-900k
- Cr√©dito: Q500-750k @ 8% / 25 a√±os
- Plazo: 25 a√±os

III. CLASIFICACI√ìN DE DEPARTAMENTOS

GRUPO A: Extrema Pobreza Rural (>80%)
- Alta Verapaz (90.3% / 58.5% extrema)
- Quich√© (86.4% / 34.4%)
- Huehuetenango (81.3% / 29.7%)
- Baja Verapaz (80.1% / 35.8%)
- Jalapa (79.9% / 34.5%)
Estrategia: N√∫cleos m√≠nimos + cooperativas + suelo comunal

GRUPO B: Pobreza Alta Mixta (50-79%)
- 13 departamentos
Estrategia: Lotes urbanizados + hipotecario + subsidio parcial

GRUPO C: Pobreza Moderada (<50%)
- Guatemala, Sacatep√©quez, Escuintla, Quetzaltenango
Estrategia: Vivienda vertical + PPP + regulaci√≥n urbana

IV. PRESUPUESTO TOTAL 2026-2029
- Subsidios FOPAVI: Q870M
- Cr√©dito IDB/BM @ 2%: Q600M
- Suelo/Urbanizaci√≥n: Q510M
- Coordinaci√≥n: Q165M
- Comunicaci√≥n/Monitoreo: Q75M
- TOTAL: Q2.237 mil millones

Beneficiarios esperados: 8,000-10,000 familias/a√±o (2027+)
Meta acumulativa 2026-2029: 20,000-30,000 familias

V. CRONOGRAMA GRACIANO (2026-2029)

TRIMESTRE 1-2 2026: Vigilancia e Investigaci√≥n
- Mapeo de suelo disponible
- Validaci√≥n de modelos piloto
- Negociaci√≥n con banca comercial
- L√≠nea IDB/BM
- Presupuesto: Q15M

TRIMESTRE 3-4 2026: Pilotos e Institucionalidad
- 5 proyectos piloto iniciados
- 200-300 familias en proceso
- Coordinadores regionales
- Presupuesto: Q60M

2027-2028: Escalado Progresivo
- 5,000-8,000 familias/a√±o
- Replicaci√≥n de pilotos exitosos
- Presupuesto: Q400-500M/a√±o

2029+: Modelo Autosostenible
- 50,000+ familias acumuladas
- Banca comercial autosustentable
- Municipios como agentes principales

VI. INDICADORES DE MONITOREO

Proceso: Viviendas iniciadas, completadas, beneficiarios √∫nicos
Calidad: Satisfacci√≥n familiar >85%, Cumplimiento de pagos >95%, Servicios accesibles 100%
Equidad: Mujeres jefas de hogar 40-50%, Poblaci√≥n ind√≠gena proporcional, Accesibilidad 5-10%
Prudencia: Adaptabilidad >30%, Replicabilidad >7/10, Gobernanza comunitaria >80%

---
Documento preparado seg√∫n principios de Moris Polanco.
Enero 2026 | Versi√≥n 1.0`;
                filename = 'housing_estrategia_completa.txt';
            } else if (type === 'datos') {
                content = JSON.stringify({
                    metadata: {
                        version: "1.0",
                        date: "2026-01-06",
                        source: "ENCOVI 2023, Acuerdo Gubernativo 256-2025, FOPAVI",
                        departments: 22,
                        last_updated: "Enero 2026"
                    },
                    departments: departmentsData,
                    salaries_2026: {
                        agricultural: 3500,
                        non_agricultural: 4252,
                        maquila: 4127
                    },
                    fopavi: {
                        subsidy_amount: 59000,
                        family_contribution: 1000,
                        max_salary_multiple: 4
                    },
                    construction_costs: {
                        basic: 2400,
                        economic: 3500,
                        social: 4500,
                        standard: 6000,
                        premium: 7200
                    }
                }, null, 2);
                filename = 'housing_datos_2026.json';
            } else if (type === 'matrices') {
                content = `MATRIZ 1: DECISI√ìN POR DEPARTAMENTO
Departamento,Grupo,Pobreza%,Extrema%,Poblaci√≥n,Urbano%,Estrategia,Meta 2026,Presupuesto
Alta Verapaz,A,90.3,58.5,1200000,10,Nucleos+Coop,500,Q42M
Quich√©,A,86.4,34.4,1100000,15,Nucleos+Coop,400,Q34M
Huehuetenango,A,81.3,29.7,1200000,20,Nucleos+Coop,350,Q30M
...

MATRIZ 2: SOLUCIONES POR TIPO DE FAMILIA
Familia,Ingreso,Vivienda,CostoTotal,SubsidioFOPAVI,Credito,CuotaMensual%Ingreso,Plazo
Extrema Rural,<1500,Nucleos 35m2,84000,59000,24000,sim,10 a√±os
Pobre Urbana,2500-3500,Economica 70m2,280000,35000,200000,43.5%,20 a√±os
Trabajadora,4500-7000,Social 95m2,445000,35000,390000,30%,25 a√±os
Clase Media,7000-12000,Estandar 130m2,720000,0-20000,500000,27-30%,25 a√±os

MATRIZ 3: INDICADORES DE VIABILIDAD
Indicador,Meta,Umbral Cr√≠tico,Frecuencia Monitoreo
Viviendas Iniciadas/a√±o,8000,>6000,Mensual
Viviendas Completadas/a√±o,3000,>1500,Trimestral
Satisfacci√≥n Familiar,>85%,<75%,Semestral
Cumplimiento de Pagos,>95%,<85%,Mensual
Cobertura Departamental,20+ de 22,>15,Anual

MATRIZ 4: PRESUPUESTO ANUAL
Rubro,2026,2027,2028,2029,Total
Subsidios FOPAVI,60M,180M,280M,350M,870M
Credito IDB/BM,0,100M,200M,300M,600M
Suelo/Urbanizacion,30M,100M,180M,200M,510M
Coordinacion,15M,40M,60M,50M,165M
Comunicacion,5M,15M,25M,30M,75M
TOTAL,112M,440M,750M,935M,2237M

MATRIZ 5: RIESGOS Y MITIGACIONES
Riesgo,Se√±al de Alerta,Mitigaci√≥n
Cooptacion Politica,>30% en municipios afines,Veedur√≠a independiente + asignaci√≥n por f√≥rmula
Insostenibilidad Creditos,Morosidad >15%,Fondos de socorro + tasa 0% en crisis
Gentrificacion Urbana,Reventa >20% en 5 a√±os,Congelamiento 10 a√±os + preferencia comunitaria
Viviendas Vacias,Ocupacion <80%,Requisito de residencia 5 a√±os
Falta Equipamiento,Sin escuela/salud 500m,Coordinacion MINEDU+MSPAS
Debil Capacidad Municipal,Retrasos >6 meses,Coordinadores regionales con autoridad`;
                filename = 'housing_matrices_operativas.csv';
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Inicializar
        window.addEventListener('load', () => {
            loadDepartments();
            loadFamilyTypes();
            loadSolutions();
            filterMatrixSolutions();
        });
    </script>
</body>
</html>
